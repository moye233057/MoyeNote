上下文管理器协议

1.最常见的上下文管理器是文件管理:
with open(filepath, 'r', encoding='utf-8') as f:
     pass

2.也可以用class来创建一个上下文管理器类:
class Sample:
    def __enter__(self):
        print("enter")
        # 获取资源
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        # 释放资源
        print("exit")

    def do_something(self):
        print("do")

with Sample() as sample:
    sample.do_something()

3.用contextlib构建
import contextlib
@contextlib.contextmanager  #用装饰器的形式将一个方法变为上下文管理器
def file_open(file_name):
    print("fileopen")  # fileopen相当于__enter__的逻辑
    yield {}  # yield是必须的，{}不是必须的
    print("fileclose") # fileclose相当于__exit__的逻辑